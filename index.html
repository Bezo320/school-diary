<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <style>
    :root {
      --bg:#fff7ed; --card:#ffffff; --primary:#f97316; --text:#1f2937;
    }
    body.dark { --bg:#1f2937; --card:#111827; --primary:#fb923c; --text:#f9fafb; }
    body { margin:0; font-family:Arial,sans-serif; background:var(--bg); color:var(--text); transition:.3s; }
    header { background:var(--primary); color:white; padding:15px 20px; font-size:20px; display:flex; justify-content:space-between; align-items:center; }
    .container { max-width:1000px; margin:auto; padding:20px; }
    .card { background:var(--card); padding:20px; border-radius:14px; margin-bottom:20px; box-shadow:0 10px 25px rgba(0,0,0,.08); }
    input, select, button { padding:10px; margin:6px 0; width:100%; border-radius:8px; border:1px solid #ddd; }
    button { background:var(--primary); color:white; border:none; cursor:pointer; }
    table { width:100%; border-collapse:collapse; }
    th, td { padding:10px; border-bottom:1px solid #e5e7eb; text-align:center; }
    th { background:#fed7aa; }
    body.dark th { background:#374151; }
    .hidden { display:none; }
  </style>
</head>
<body>
<header>üìò –≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫ <button onclick="toggleTheme()">üåó –°–º–µ–Ω–∏—Ç—å —Ç–µ–º—É</button></header>
<div class="container">

<!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
<div class="card" id="login">
  <h2>–í—Ö–æ–¥</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
  <select id="role">
    <option value="student">–£—á–µ–Ω–∏–∫</option>
    <option value="teacher">–£—á–∏—Ç–µ–ª—å</option>
  </select>
  <input id="className" placeholder="–ö–ª–∞—Å—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä 10–ê)">
  <button onclick="loginUser()">–í–æ–π—Ç–∏ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
</div>

<!-- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
<div id="app" class="hidden">

  <!-- –ü–∞–Ω–µ–ª—å —É—á–∏—Ç–µ–ª—è -->
  <div class="card hidden" id="teacherPanel">
    <h3>–î–æ–±–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</h3>
    <input id="subject" placeholder="–ü—Ä–µ–¥–º–µ—Ç">
    <input id="topic" placeholder="–¢–µ–º–∞">
    <input id="mark" type="number" min="2" max="5" placeholder="–û—Ü–µ–Ω–∫–∞">
    <button onclick="addMark()">–î–æ–±–∞–≤–∏—Ç—å</button>
  </div>

  <!-- –û—Ü–µ–Ω–∫–∏ -->
  <div class="card">
    <h3>–û—Ü–µ–Ω–∫–∏</h3>
    <select id="filter" onchange="renderMarks()">
      <option value="all">–í—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã</option>
    </select>
    <table>
      <thead><tr><th>–ü—Ä–µ–¥–º–µ—Ç</th><th>–¢–µ–º–∞</th><th>–û—Ü–µ–Ω–∫–∞</th></tr></thead>
      <tbody id="marks"></tbody>
    </table>
    <p><b>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª:</b> <span id="avg"></span></p>
  </div>

  <!-- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ -->
  <div class="card">
    <h3>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
    <select id="dayFilter" onchange="renderSchedule()">
      <option value="all">–í—Å–µ –¥–Ω–∏</option>
      <option value="–ü–Ω">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</option>
      <option value="–í—Ç">–í—Ç–æ—Ä–Ω–∏–∫</option>
      <option value="–°—Ä">–°—Ä–µ–¥–∞</option>
      <option value="–ß—Ç">–ß–µ—Ç–≤–µ—Ä–≥</option>
      <option value="–ü—Ç">–ü—è—Ç–Ω–∏—Ü–∞</option>
    </select>
    <ul id="scheduleList"></ul>
  </div>

  <!-- –í—ã—Ö–æ–¥ -->
  <div class="card">
    <button onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
  </div>

</div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCEo8QxfX8faFjUaQNwNlTXbvws7LgXAEs",
    authDomain: "school-diary-3798a.firebaseapp.com",
    databaseURL: "https://school-diary-3798a.firebaseapp.com",
    projectId: "school-diary-3798a"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();

  let userRole = null;
  let userClass = null;
  let allMarks = [];
  const scheduleData = { '–ü–Ω':['–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞','–†—É—Å—Å–∫–∏–π'], '–í—Ç':['–§–∏–∑–∏–∫–∞','–ò—Å—Ç–æ—Ä–∏—è'], '–°—Ä':['–ê–Ω–≥–ª–∏–π—Å–∫–∏–π','–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞'], '–ß—Ç':['–•–∏–º–∏—è','–ì–µ–æ–≥—Ä–∞—Ñ–∏—è'], '–ü—Ç':['–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞','–ë–∏–æ–ª–æ–≥–∏—è'] };

  function toggleTheme() { 
    document.body.classList.toggle('dark'); 
    localStorage.setItem('theme', document.body.classList.contains('dark')); 
  }
  
  if(localStorage.getItem('theme')==='true') document.body.classList.add('dark');

  function loginUser() {
    userRole = document.getElementById('role').value; 
    userClass = document.getElementById('className').value;
    const em = document.getElementById('email').value; 
    const pw = document.getElementById('password').value;
    auth.signInWithEmailAndPassword(em,pw).catch(()=>auth.createUserWithEmailAndPassword(em,pw));
  }

  function logout() { 
    auth.signOut(); 
    document.getElementById('app').classList.add('hidden'); 
    document.getElementById('login').classList.remove('hidden'); 
  }

  auth.onAuthStateChanged(u=>{
    if(u){
      document.getElementById('login').classList.add('hidden'); 
      document.getElementById('app').classList.remove('hidden');
      if(userRole==='teacher') document.getElementById('teacherPanel').classList.remove('hidden');
      loadMarks(); renderSchedule();
    }
  });

  function addMark(){
    const data={
      class:userClass,
      subject:document.getElementById('subject').value,
      topic:document.getElementById('topic').value,
      mark:Number(document.getElementById('mark').value)
    };
    db.ref('marks').push(data);
  }

  function loadMarks(){
    db.ref('marks').on('value', snap=>{
      allMarks=[];
      snap.forEach(s=>{const d=s.val(); if(d.class===userClass) allMarks.push(d);});
      fillSubjects(); renderMarks();
    });
  }

  function fillSubjects(){
    const subjects=[...new Set(allMarks.map(m=>m.subject))];
    const f = document.getElementById('filter');
    f.innerHTML='<option value="all">–í—Å–µ –ø—Ä–µ–¥–º–µ—Ç—ã</option>';
    subjects.forEach(s => {
      f.innerHTML += '<option value="' + s + '">' + s + '</option>';
    });
  }

  function renderMarks(){
    const mTable = document.getElementById('marks');
    mTable.innerHTML=''; 
    let sum=0, count=0; 
    const f = document.getElementById('filter').value;
    allMarks.filter(m=>f==='all'||m.subject===f).forEach(m=>{ 
      sum+=m.mark; count++; 
      mTable.innerHTML += '<tr><td>' + m.subject + '</td><td>' + m.topic + '</td><td>' + m.mark + '</td></tr>';
    });
    document.getElementById('avg').textContent = count ? (sum/count).toFixed(2) : '-';
  }

  function renderSchedule(){
    const day = document.getElementById('dayFilter').value;
    const sList = document.getElementById('scheduleList');
    sList.innerHTML='';
    if(day==='all'){ 
      for(const d in scheduleData){ 
        sList.innerHTML += '<li><b>' + d + '</b>: ' + scheduleData[d].join(', ') + '</li>'; 
      } 
    } else { 
      if(scheduleData[day]) sList.innerHTML = '<li><b>' + day + '</b>: ' + scheduleData[day].join(', ') + '</li>'; 
    }
  }
</script>



</script>
</body>
</html>





